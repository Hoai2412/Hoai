<UserControl x:Class="QuanLySinhVien.ThongKeBaoCao"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
             mc:Ignorable="d"
             d:DesignHeight="600" d:DesignWidth="1000"
             Background="#F9FAFB">

    <Grid Margin="25">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- ===== HEADER ===== -->
        <StackPanel Orientation="Horizontal" Margin="0,0,0,20">
            <materialDesign:PackIcon Kind="ChartBoxOutline"
                                     Width="30" Height="30"
                                     Foreground="#1E3A8A"
                                     Margin="0,0,10,0"/>
            <TextBlock Text="THỐNG KÊ – BÁO CÁO HỌC TẬP"
                       FontSize="22"
                       FontWeight="Bold"
                       Foreground="#1E3A8A"
                       VerticalAlignment="Center"/>
        </StackPanel>

        <!-- ===== BỘ LỌC + BẢNG DỮ LIỆU ===== -->
        <Border Grid.Row="1"
                Background="White"
                CornerRadius="10"
                Padding="16"
                BorderBrush="#E2E8F0"
                BorderThickness="1">
            <DockPanel LastChildFill="True">

                <!-- BỘ LỌC -->
                <Grid DockPanel.Dock="Top" Margin="0,0,0,12">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="1.5*" />
                    </Grid.ColumnDefinitions>

                    <!-- Khoa -->
                    <StackPanel Grid.Column="0" Margin="4,0">
                        <TextBlock Text="Khoa" FontWeight="Bold" Margin="0,0,0,4" TextWrapping="Wrap"/>
                        <ComboBox x:Name="cbKhoa" Height="34" SelectionChanged="Filter_Changed"/>
                    </StackPanel>

                    <!-- Ngành -->
                    <StackPanel Grid.Column="1" Margin="4,0">
                        <TextBlock Text="Ngành" FontWeight="Bold" Margin="0,0,0,4" TextWrapping="Wrap"/>
                        <ComboBox x:Name="cbNganh" Height="34" SelectionChanged="Filter_Changed"/>
                    </StackPanel>

                    <!-- Môn học -->
                    <StackPanel Grid.Column="2" Margin="4,0">
                        <TextBlock Text="Môn học" FontWeight="Bold" Margin="0,0,0,4" TextWrapping="Wrap"/>
                        <ComboBox x:Name="cbMon" Height="34" SelectionChanged="Filter_Changed"/>
                    </StackPanel>

                    <!-- Lớp học phần -->
                    <StackPanel Grid.Column="3" Margin="4,0">
                        <TextBlock Text="Lớp học phần" FontWeight="Bold" Margin="0,0,0,4" TextWrapping="Wrap"/>
                        <ComboBox x:Name="cbLopHP" Height="34" SelectionChanged="Filter_Changed"/>
                    </StackPanel>

                    <!-- Học kỳ -->
                    <StackPanel Grid.Column="4" Margin="4,0">
                        <TextBlock Text="Học kỳ" FontWeight="Bold" Margin="0,0,0,4" TextWrapping="Wrap"/>
                        <ComboBox x:Name="cbHocKy" Height="34" SelectionChanged="Filter_Changed"/>
                    </StackPanel>

                    <!-- Tìm kiếm -->
                    <StackPanel Grid.Column="5" Margin="4,0">
                        <TextBlock Text="Tìm nhanh (MSSV / Họ tên)" FontWeight="Bold" Margin="0,0,0,4" TextWrapping="Wrap"/>
                        <TextBox x:Name="txtSearch" Height="34" Padding="8,0" TextChanged="Filter_Changed"/>
                    </StackPanel>
                </Grid>

                <!-- ===== BẢNG KẾT QUẢ ===== -->
                <DataGrid x:Name="dgBaoCao"
                          AutoGenerateColumns="False"
                          CanUserAddRows="False"
                          AlternatingRowBackground="#F1F5F9"
                          RowHeight="34"
                          GridLinesVisibility="Horizontal"
                          BorderBrush="#E2E8F0"
                          BorderThickness="1"
                          Background="White"
                          FontSize="14">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="MSSV" Binding="{Binding MaSV}" Width="1.1*"/>
                        <DataGridTextColumn Header="Họ tên" Binding="{Binding HoTen}" Width="2*"/>
                        <DataGridTextColumn Header="Khoa" Binding="{Binding Khoa}" Width="1.2*"/>
                        <DataGridTextColumn Header="Ngành" Binding="{Binding Nganh}" Width="1.6*"/>
                        <DataGridTextColumn Header="Môn học" Binding="{Binding TenMon}" Width="2*"/>
                        <DataGridTextColumn Header="Lớp HP" Binding="{Binding LopHP}" Width="1.1*"/>
                        <DataGridTextColumn Header="Học kỳ" Binding="{Binding HocKy}" Width="1.2*"/>
                        <DataGridTextColumn Header="Tín chỉ" Binding="{Binding TinChi}" Width="0.8*"/>
                        <DataGridTextColumn Header="GK" Binding="{Binding DiemGK}" Width="0.8*"/>
                        <DataGridTextColumn Header="CK" Binding="{Binding DiemCK}" Width="0.8*"/>
                        <DataGridTextColumn Header="Tổng kết" Binding="{Binding DiemTK}" Width="1*"/>
                        <DataGridTextColumn Header="Kết quả" Binding="{Binding KetQua}" Width="1*"/>
                    </DataGrid.Columns>
                </DataGrid>
            </DockPanel>
        </Border>

        <!-- ===== THANH HÀNH ĐỘNG ===== -->
        <StackPanel Grid.Row="2"
                    Orientation="Horizontal"
                    HorizontalAlignment="Center"
                    Margin="0,16,0,0">
            <Button Content="Tổng hợp"
                    Width="150"
                    Height="38"
                    Background="#2563EB"
                    Foreground="White"
                    FontWeight="Bold"
                    Margin="6"
                    Click="BtnTongHop_Click"/>
            <Button Content="Xuất Excel"
                    Width="150"
                    Height="38"
                    Background="#16A34A"
                    Foreground="White"
                    FontWeight="Bold"
                    Margin="6"
                    Click="BtnExcel_Click"/>
            <Button Content="Xuất PDF"
                    Width="150"
                    Height="38"
                    Background="#F59E0B"
                    Foreground="White"
                    FontWeight="Bold"
                    Margin="6"
                    Click="BtnPdf_Click"/>
        </StackPanel>
    </Grid>
</UserControl>
